define(function(h){var f="storage-global";var j=f+"-index";var n=location.hostname;var p=location.pathname;var m=location.hash.slice(1);var l=null;function o(){return c()?true:false}function c(){if(l){return l}if("localStorage" in window){try{window.localStorage.setItem("_tmptest","tmpval");window.localStorage.removeItem("_tmptest");l=window.localStorage}catch(y){}}if(!l&&"sessionStorage" in window){try{window.sessionStorage.setItem("_tmptest","tmpval");window.sessionStorage.removeItem("_tmptest");l=window.sessionStorage}catch(y){}}if(l){return l}else{var z=document.createElement("link");if(z.addBehavior){z.style.behavior="url(#default#userData)";document.getElementsByTagName("head")[0].appendChild(z);l={setItem:function(A,B){z.setAttribute("key",B);z.save(f)},getItem:function(A){z.load(f);return z.getAttribute(A)},removeItem:function(A){z.load(f);z.removeAttribute(A);z.save(f)}};return l}else{z=null;return null}}}function d(z,A,y,B){var z=v(z,B);s(z,y);e(z,A)}function i(z,A){var z=v(z,A);var y=r(z);if(y&&y>(new Date().getTime())){return w(z)}else{x(z);e(z,null);return null}}function u(y,z){var y=v(y,z);x(y);e(y,null)}function q(B){B=B?B:n;var A=b();var y=A[B];for(var z in y){if(y.hasOwnProperty(z)){delete y[z];e(z,null)}}delete A[B]}function a(){var A=b();for(var B in A){if(A.hasOwnProperty(B)){var y=A[B];for(var z in y){if(y.hasOwnProperty(z)){delete y[z];e(z,null)}delete A[B]}}}}function g(){return b()}function e(y,z){c();if(l){if(z){if(!k(z)){z=JSON.stringify(z)}l.setItem(y,z)}else{l.removeItem(y)}}}function w(y){c();if(l){return l.getItem(y)}return null}function v(y,z){return n+p+"#"+(z?z:m)+"@"+y}function b(){var y=w(j);return JSON.parse(y)}function s(A,z){z=z?z:Number.MAX_VALUE;var B=b();var y=B[n];if(y){y[A]=z}else{B[n]={key:z}}e(j,JSON.stringify(B))}function x(z){var A=b();var y=A[n];if(y&&y[z]){delete y[z]}e(j,JSON.stringify(A))}function r(z){var A=b();var y=A[n];return y?y[z]:null}function k(y){return Object.prototype.toString.call(value).slice(8,-1)==="String"}var t={available:o,setItem:d,getItem:i,removeItem:u,clear:q,clearAll:a,index:g};return t});